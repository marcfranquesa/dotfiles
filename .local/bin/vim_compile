#!/bin/sh

# back-end script that compiles different programming languages

file=$(readlink -f "$1")
dir=${file%/*}
base="${file%.*}"
ext="${file##*.}"

cd "$dir" || exit 1

textype() { \
  command="pdflatex -shell-escape"
  $command --output-directory="$dir" "$base" &&
  grep -qi addbibresource "$file" &&
  biber "$base" &&
  $command --output-directory="$dir" "$base" &&
  $command --output-directory="$dir" "$base"
}

case "$ext" in
  tex) textype "$file" ;;
  *) sed -n '/^#!/s/^#!//p; q' "$file" | xargs -r -I % "$file" ;;
esac
